<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì„ ìƒë‹˜ì˜ AI ë¹„ì„œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;900&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1410;
    --paper: #f5f0e8;
    --cream: #ede8dc;
    --brush: #8B4513;
    --gold: #c9963a;
    --sage: #6b7c5e;
    --red: #c0392b;
    --shadow: rgba(26,20,16,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 31px, rgba(139,69,19,0.04) 31px, rgba(139,69,19,0.04) 32px);
  }

  /* Header */
  header {
    background: var(--ink);
    padding: 24px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 20px var(--shadow);
  }

  .logo {
    font-family: 'Noto Serif KR', serif;
    font-weight: 900;
    font-size: 1.4rem;
    color: var(--paper);
    letter-spacing: -0.02em;
  }

  .logo span {
    color: var(--gold);
  }

  .status-dot {
    width: 8px; height: 8px;
    background: #4caf50;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .header-right {
    font-size: 0.8rem;
    color: rgba(245,240,232,0.6);
    display: flex;
    align-items: center;
  }

  /* Tab Nav */
  .tab-nav {
    display: flex;
    background: var(--cream);
    border-bottom: 2px solid rgba(139,69,19,0.12);
    padding: 0 40px;
    overflow-x: auto;
    gap: 0;
  }

  .tab-btn {
    padding: 16px 24px;
    background: none;
    border: none;
    cursor: pointer;
    font-family: 'Noto Serif KR', serif;
    font-size: 0.9rem;
    font-weight: 600;
    color: rgba(26,20,16,0.45);
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    white-space: nowrap;
    transition: all 0.2s;
    letter-spacing: -0.01em;
  }

  .tab-btn:hover { color: var(--brush); }

  .tab-btn.active {
    color: var(--brush);
    border-bottom-color: var(--brush);
  }

  .tab-icon { margin-right: 6px; }

  /* Main Layout */
  .main {
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 24px;
  }

  /* Panel */
  .panel { display: none; animation: fadeIn 0.3s ease; }
  .panel.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .panel-header {
    margin-bottom: 32px;
  }

  .panel-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--ink);
    line-height: 1.2;
    margin-bottom: 6px;
  }

  .panel-title .accent { color: var(--brush); }

  .panel-desc {
    font-size: 0.9rem;
    color: rgba(26,20,16,0.55);
    line-height: 1.6;
  }

  /* Form Elements */
  .form-group { margin-bottom: 20px; }

  label {
    display: block;
    font-size: 0.82rem;
    font-weight: 500;
    color: rgba(26,20,16,0.6);
    margin-bottom: 8px;
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  input, select, textarea {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid rgba(139,69,19,0.2);
    border-radius: 8px;
    background: white;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 0.9rem;
    color: var(--ink);
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }

  input:focus, select:focus, textarea:focus {
    border-color: var(--brush);
    box-shadow: 0 0 0 3px rgba(139,69,19,0.08);
  }

  textarea { min-height: 120px; resize: vertical; line-height: 1.7; }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  /* Buttons */
  .btn-primary {
    background: var(--ink);
    color: var(--paper);
    border: none;
    padding: 15px 32px;
    border-radius: 8px;
    font-family: 'Noto Serif KR', serif;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    letter-spacing: -0.01em;
  }

  .btn-primary:hover {
    background: var(--brush);
    transform: translateY(-1px);
    box-shadow: 0 4px 16px var(--shadow);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* Result Box */
  .result-box {
    margin-top: 32px;
    background: white;
    border: 1.5px solid rgba(139,69,19,0.15);
    border-radius: 12px;
    overflow: hidden;
  }

  .result-header {
    background: var(--ink);
    padding: 14px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .result-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 0.85rem;
    color: var(--gold);
    font-weight: 600;
  }

  .copy-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    color: rgba(245,240,232,0.7);
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 0.75rem;
    cursor: pointer;
    font-family: 'Noto Sans KR', sans-serif;
    transition: all 0.2s;
  }

  .copy-btn:hover { background: rgba(255,255,255,0.2); color: white; }

  .result-content {
    padding: 24px;
    font-size: 0.92rem;
    line-height: 1.9;
    color: var(--ink);
    white-space: pre-wrap;
    min-height: 100px;
  }

  .result-placeholder {
    color: rgba(26,20,16,0.3);
    font-style: italic;
    text-align: center;
    padding: 40px 20px;
  }

  /* Loading */
  .loading-dots {
    display: inline-flex;
    gap: 4px;
    align-items: center;
  }

  .loading-dots span {
    width: 6px; height: 6px;
    background: var(--gold);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }

  .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
  .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
    40% { transform: scale(1); opacity: 1; }
  }

  /* API Key section */
  .api-section {
    background: rgba(201,150,58,0.08);
    border: 1.5px solid rgba(201,150,58,0.3);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 32px;
  }

  .api-section h3 {
    font-family: 'Noto Serif KR', serif;
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--brush);
  }

  .api-section p {
    font-size: 0.82rem;
    color: rgba(26,20,16,0.6);
    margin-bottom: 12px;
    line-height: 1.6;
  }

  .api-input-row {
    display: flex;
    gap: 10px;
  }

  .api-input-row input {
    flex: 1;
    font-family: monospace;
    font-size: 0.82rem;
  }

  .btn-save {
    padding: 14px 20px;
    background: var(--gold);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 0.85rem;
    white-space: nowrap;
    transition: all 0.2s;
  }

  .btn-save:hover { background: var(--brush); }

  /* Poem special styling */
  .poem-result {
    font-family: 'Noto Serif KR', serif;
    line-height: 2.2;
    font-size: 1rem;
    text-align: center;
    padding: 40px;
    background: linear-gradient(180deg, white, var(--cream));
  }

  /* Chip tags */
  .chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
  }

  .chip {
    padding: 6px 14px;
    border: 1.5px solid rgba(139,69,19,0.25);
    border-radius: 20px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
    color: rgba(26,20,16,0.65);
  }

  .chip:hover, .chip.selected {
    background: var(--brush);
    border-color: var(--brush);
    color: white;
  }

  /* Warning */
  .warning-box {
    background: rgba(192,57,43,0.06);
    border-left: 3px solid var(--red);
    padding: 12px 16px;
    border-radius: 0 8px 8px 0;
    font-size: 0.82rem;
    color: rgba(26,20,16,0.65);
    margin-top: 12px;
    line-height: 1.6;
  }

  /* === í•™ìƒ ìƒë‹´ ìŠ¤íƒ€ì¼ === */
  .counsel-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 24px;
    min-height: 600px;
  }

  /* í•™ìƒ ëª©ë¡ ì‚¬ì´ë“œë°” */
  .student-sidebar {
    background: white;
    border: 1.5px solid rgba(139,69,19,0.15);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .sidebar-header {
    background: var(--ink);
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .sidebar-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 0.85rem;
    color: var(--gold);
    font-weight: 600;
  }

  .btn-add-student {
    background: var(--gold);
    border: none;
    color: white;
    width: 26px; height: 26px;
    border-radius: 50%;
    font-size: 1.1rem;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    line-height: 1;
  }

  .btn-add-student:hover { background: var(--brush); transform: scale(1.1); }

  .student-search {
    padding: 10px 12px;
    border-bottom: 1px solid rgba(139,69,19,0.1);
  }

  .student-search input {
    padding: 8px 12px;
    font-size: 0.82rem;
    border-radius: 6px;
  }

  .student-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
  }

  .student-card {
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    margin-bottom: 4px;
    border: 1.5px solid transparent;
  }

  .student-card:hover { background: var(--cream); }

  .student-card.active {
    background: rgba(139,69,19,0.08);
    border-color: rgba(139,69,19,0.25);
  }

  .student-card-name {
    font-family: 'Noto Serif KR', serif;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--ink);
  }

  .student-card-meta {
    font-size: 0.75rem;
    color: rgba(26,20,16,0.45);
    margin-top: 2px;
  }

  .student-card-badge {
    display: inline-block;
    background: var(--sage);
    color: white;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 6px;
    vertical-align: middle;
  }

  /* ìƒë‹´ ìƒì„¸ ì˜ì—­ */
  .counsel-detail {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .detail-card {
    background: white;
    border: 1.5px solid rgba(139,69,19,0.15);
    border-radius: 12px;
    overflow: hidden;
  }

  .detail-card-header {
    background: var(--cream);
    padding: 12px 18px;
    border-bottom: 1px solid rgba(139,69,19,0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .detail-card-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 0.88rem;
    font-weight: 600;
    color: var(--brush);
  }

  .detail-card-body {
    padding: 18px;
  }

  /* ìƒë‹´ ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ */
  .record-list { display: flex; flex-direction: column; gap: 12px; }

  .record-item {
    border: 1.5px solid rgba(139,69,19,0.12);
    border-radius: 8px;
    padding: 14px 16px;
    background: var(--paper);
    position: relative;
  }

  .record-item-date {
    font-size: 0.75rem;
    color: rgba(26,20,16,0.4);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .record-type-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 500;
  }

  .badge-student { background: rgba(107,124,94,0.15); color: var(--sage); }
  .badge-parent { background: rgba(201,150,58,0.15); color: #9a6f1e; }

  .record-item-content {
    font-size: 0.88rem;
    line-height: 1.7;
    color: var(--ink);
    white-space: pre-wrap;
  }

  .record-delete {
    position: absolute;
    top: 10px; right: 10px;
    background: none;
    border: none;
    color: rgba(26,20,16,0.25);
    cursor: pointer;
    font-size: 1rem;
    transition: color 0.2s;
  }

  .record-delete:hover { color: var(--red); }

  /* ëª¨ë‹¬ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(2px);
  }

  .modal {
    background: var(--paper);
    border-radius: 16px;
    width: 100%;
    max-width: 520px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(26,20,16,0.3);
    animation: modalIn 0.25s ease;
  }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.95) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-header {
    background: var(--ink);
    padding: 20px 24px;
    border-radius: 16px 16px 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .modal-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--paper);
  }

  .modal-close {
    background: none;
    border: none;
    color: rgba(245,240,232,0.6);
    font-size: 1.4rem;
    cursor: pointer;
    transition: color 0.2s;
    line-height: 1;
  }

  .modal-close:hover { color: white; }

  .modal-body { padding: 24px; }

  .modal-footer {
    padding: 0 24px 24px;
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .btn-secondary {
    padding: 12px 20px;
    background: var(--cream);
    border: 1.5px solid rgba(139,69,19,0.2);
    border-radius: 8px;
    font-family: 'Noto Serif KR', serif;
    font-size: 0.88rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--ink);
  }

  .btn-secondary:hover { background: var(--paper); }

  /* ë¹ˆ ìƒíƒœ */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: rgba(26,20,16,0.35);
  }

  .empty-state .empty-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .empty-state p { font-size: 0.88rem; line-height: 1.6; }

  .sub-tabs {
    display: flex;
    gap: 0;
    border-bottom: 1.5px solid rgba(139,69,19,0.12);
    margin-bottom: 20px;
  }

  .sub-tab {
    padding: 10px 18px;
    background: none;
    border: none;
    cursor: pointer;
    font-family: 'Noto Serif KR', serif;
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(26,20,16,0.4);
    border-bottom: 2px solid transparent;
    margin-bottom: -1.5px;
    transition: all 0.2s;
  }

  .sub-tab.active {
    color: var(--brush);
    border-bottom-color: var(--brush);
  }

  .sub-panel { display: none; }
  .sub-panel.active { display: block; }

  /* Responsive */
  @media (max-width: 700px) {
    .counsel-layout { grid-template-columns: 1fr; }
    .student-sidebar { max-height: 250px; }
  }

  /* Responsive */
  @media (max-width: 600px) {
    .form-row { grid-template-columns: 1fr; }
    header { padding: 16px 20px; }
    .tab-nav { padding: 0 16px; }
    .main { padding: 24px 16px; }
    .panel-title { font-size: 1.4rem; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">ì„ ìƒë‹˜ì˜ <span>AI ë¹„ì„œ</span></div>
  <div class="header-right">
    <span class="status-dot"></span>ì¤€ë¹„ë¨
  </div>
</header>

<nav class="tab-nav">
  <button class="tab-btn active" onclick="showTab('lesson')"><span class="tab-icon">ğŸ“š</span>ìˆ˜ì—… ìë£Œ</button>
  <button class="tab-btn" onclick="showTab('grade')"><span class="tab-icon">âœï¸</span>ì±„ì /í”¼ë“œë°±</button>
  <button class="tab-btn" onclick="showTab('poem')"><span class="tab-icon">ğŸŒ¿</span>ì‹œ ì°½ì‘</button>
  <button class="tab-btn" onclick="showTab('schedule')"><span class="tab-icon">ğŸ“…</span>ì—…ë¬´ ì •ë¦¬</button>
  <button class="tab-btn" onclick="showTab('stock')"><span class="tab-icon">ğŸ“ˆ</span>ì£¼ì‹ ë¶„ì„</button>
  <button class="tab-btn" onclick="showTab('counsel')"><span class="tab-icon">ğŸ«‚</span>í•™ìƒ ìƒë‹´</button>
</nav>

<main class="main">

  <!-- API Key -->
  <div class="api-section">
    <h3>ğŸ”‘ Claude API í‚¤ ì„¤ì •</h3>
    <p>Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì‘ë‹µí•©ë‹ˆë‹¤. í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
    <a href="https://aistudio.google.com" target="_blank" style="color:var(--brush)">aistudio.google.com</a>ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆì–´ìš”.</p>
    <div class="api-input-row">
      <input type="password" id="apiKey" placeholder="AIza..." />
      <button class="btn-save" onclick="saveKey()">ì €ì¥</button>
      <button class="btn-save" style="background:rgba(26,20,16,0.3)" onclick="deleteKey()">ì‚­ì œ</button>
    </div>
  </div>

  <!-- ìˆ˜ì—… ìë£Œ -->
  <div id="panel-lesson" class="panel active">
    <div class="panel-header">
      <div class="panel-title">ìˆ˜ì—… ìë£Œ <span class="accent">ìë™ ìƒì„±</span></div>
      <div class="panel-desc">ë‹¨ì› ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ í•™ìŠµì§€, í€´ì¦ˆ, ìˆ˜ì—… ê°œìš”ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ ë“œë ¤ìš”.</div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>ê³¼ëª©</label>
        <input type="text" id="l-subject" placeholder="ì˜ˆ: êµ­ì–´, ìˆ˜í•™, ì˜ì–´..." />
      </div>
      <div class="form-group">
        <label>í•™ë…„</label>
        <select id="l-grade">
          <option value="">ì„ íƒ</option>
          <option>ì´ˆë“± 1~2í•™ë…„</option>
          <option>ì´ˆë“± 3~4í•™ë…„</option>
          <option>ì´ˆë“± 5~6í•™ë…„</option>
          <option>ì¤‘í•™êµ 1í•™ë…„</option>
          <option>ì¤‘í•™êµ 2í•™ë…„</option>
          <option>ì¤‘í•™êµ 3í•™ë…„</option>
          <option>ê³ ë“±í•™êµ 1í•™ë…„</option>
          <option>ê³ ë“±í•™êµ 2í•™ë…„</option>
          <option>ê³ ë“±í•™êµ 3í•™ë…„</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>ë‹¨ì› / ì£¼ì œ</label>
      <input type="text" id="l-topic" placeholder="ì˜ˆ: ì¡°ì„  ê±´êµ­, ë¶„ìˆ˜ì˜ ê³±ì…ˆ, ì‹œì˜ ìš´ìœ¨..." />
    </div>

    <div class="form-group">
      <label>ìƒì„±í•  ìë£Œ ì¢…ë¥˜</label>
      <div class="chip-group" id="material-chips">
        <div class="chip selected" onclick="toggleChip(this)">ìˆ˜ì—… ê°œìš”</div>
        <div class="chip" onclick="toggleChip(this)">í•™ìŠµì§€ (ë¹ˆì¹¸ì±„ìš°ê¸°)</div>
        <div class="chip" onclick="toggleChip(this)">í€´ì¦ˆ 5ë¬¸í•­</div>
        <div class="chip" onclick="toggleChip(this)">í† ë¡  ì§ˆë¬¸</div>
        <div class="chip" onclick="toggleChip(this)">í•µì‹¬ ìš©ì–´ ì •ë¦¬</div>
      </div>
    </div>

    <button class="btn-primary" onclick="runLesson()">
      <span>âœ¨</span> ìë£Œ ìƒì„±í•˜ê¸°
    </button>

    <div class="result-box" id="lesson-result" style="display:none">
      <div class="result-header">
        <span class="result-title">ìƒì„±ëœ ìˆ˜ì—… ìë£Œ</span>
        <button class="copy-btn" onclick="copyResult('lesson-content')">ë³µì‚¬</button>
      </div>
      <div class="result-content" id="lesson-content">
        <div class="result-placeholder">ìë£Œë¥¼ ìƒì„±í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
      </div>
    </div>
  </div>

  <!-- ì±„ì /í”¼ë“œë°± -->
  <div id="panel-grade" class="panel">
    <div class="panel-header">
      <div class="panel-title">ì±„ì  Â· <span class="accent">í”¼ë“œë°± ë³´ì¡°</span></div>
      <div class="panel-desc">í•™ìƒ ê¸€ì´ë‚˜ ë‹µì•ˆì„ ë¶™ì—¬ë„£ìœ¼ë©´ ë£¨ë¸Œë¦­ ê¸°ë°˜ í”¼ë“œë°±ì„ ìë™ìœ¼ë¡œ ì‘ì„±í•´ ë“œë ¤ìš”.</div>
    </div>

    <div class="form-group">
      <label>í‰ê°€ ê¸°ì¤€ / ë£¨ë¸Œë¦­ (ì„ íƒ)</label>
      <input type="text" id="g-rubric" placeholder="ì˜ˆ: ì°½ì˜ì„±, ë…¼ë¦¬ì„±, ë§ì¶¤ë²• â€” ì—†ìœ¼ë©´ AIê°€ ì ì ˆíˆ íŒë‹¨í•©ë‹ˆë‹¤" />
    </div>

    <div class="form-group">
      <label>í•™ìƒ ë‹µì•ˆ / ê¸€</label>
      <textarea id="g-student" placeholder="í•™ìƒì´ ì‘ì„±í•œ ë‚´ìš©ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
    </div>

    <div class="form-group">
      <label>í”¼ë“œë°± í†¤</label>
      <div class="chip-group" id="tone-chips">
        <div class="chip selected" onclick="selectOne(this, 'tone-chips')">ë”°ëœ»í•˜ê³  ê²©ë ¤ì </div>
        <div class="chip" onclick="selectOne(this, 'tone-chips')">ê°ê´€ì Â·êµ¬ì²´ì </div>
        <div class="chip" onclick="selectOne(this, 'tone-chips')">ê°„ê²°Â·ì§ì ‘ì </div>
      </div>
    </div>

    <button class="btn-primary" onclick="runGrade()">
      <span>ğŸ“</span> í”¼ë“œë°± ìƒì„±
    </button>

    <div class="result-box" id="grade-result" style="display:none">
      <div class="result-header">
        <span class="result-title">í”¼ë“œë°± ê²°ê³¼</span>
        <button class="copy-btn" onclick="copyResult('grade-content')">ë³µì‚¬</button>
      </div>
      <div class="result-content" id="grade-content"></div>
    </div>
  </div>

  <!-- ì‹œ ì°½ì‘ -->
  <div id="panel-poem" class="panel">
    <div class="panel-header">
      <div class="panel-title">ì‹œ <span class="accent">ì°½ì‘ ë„ìš°ë¯¸</span></div>
      <div class="panel-desc">ì˜¤ëŠ˜ì˜ ê°ì •ê³¼ ì†Œì¬ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”. í•¨ê»˜ ì‹œë¥¼ ì¨ ë³¼ê²Œìš”.</div>
    </div>

    <div class="form-group">
      <label>ì˜¤ëŠ˜ì˜ ê°ì • / ìƒíƒœ</label>
      <input type="text" id="p-mood" placeholder="ì˜ˆ: ê³ ìš”í•˜ë‹¤, ê·¸ë¦¬ì›€, ê¸°ì¨, í”¼ê³¤í•˜ì§€ë§Œ ë¿Œë“¯í•¨..." />
    </div>

    <div class="form-group">
      <label>ì†Œì¬ / ì´ë¯¸ì§€</label>
      <input type="text" id="p-subject" placeholder="ì˜ˆ: êµì‹¤ ì°½ë¬¸, ë‚™ì—½, í‡´ê·¼ê¸¸, ì˜¤ë˜ëœ ì±…..." />
    </div>

    <div class="form-group">
      <label>ì‹œì˜ í˜•ì‹</label>
      <div class="chip-group" id="poem-chips">
        <div class="chip selected" onclick="selectOne(this, 'poem-chips')">ììœ ì‹œ</div>
        <div class="chip" onclick="selectOne(this, 'poem-chips')">ì§§ì€ ì‹œ (10ì¤„ ì´ë‚´)</div>
        <div class="chip" onclick="selectOne(this, 'poem-chips')">ì„œì •ì‹œ</div>
        <div class="chip" onclick="selectOne(this, 'poem-chips')">í•˜ì´ì¿  ìŠ¤íƒ€ì¼</div>
      </div>
    </div>

    <div class="form-group">
      <label>ì¶”ê°€ ë©”ëª¨ (ì„ íƒ)</label>
      <textarea id="p-note" placeholder="íŠ¹ë³„íˆ ë‹´ê³  ì‹¶ì€ ë§, í”¼í•˜ê³  ì‹¶ì€ í‘œí˜„ ë“±..." style="min-height:80px"></textarea>
    </div>

    <button class="btn-primary" onclick="runPoem()">
      <span>ğŸŒ¿</span> ì‹œ ì´ˆê³  ë§Œë“¤ê¸°
    </button>

    <div class="result-box" id="poem-result" style="display:none">
      <div class="result-header">
        <span class="result-title">ì‹œ ì´ˆê³ </span>
        <button class="copy-btn" onclick="copyResult('poem-content')">ë³µì‚¬</button>
      </div>
      <div class="poem-result" id="poem-content"></div>
    </div>
  </div>

  <!-- ì—…ë¬´ ì •ë¦¬ -->
  <div id="panel-schedule" class="panel">
    <div class="panel-header">
      <div class="panel-title">ì—…ë¬´ Â· <span class="accent">ì¼ì • ì •ë¦¬</span></div>
      <div class="panel-desc">ì˜¤ëŠ˜ í•  ì¼ì´ë‚˜ í˜¼ë€ìŠ¤ëŸ¬ìš´ ì—…ë¬´ë¥¼ ë˜ì ¸ì£¼ì„¸ìš”. ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.</div>
    </div>

    <div class="form-group">
      <label>ì˜¤ëŠ˜ í•´ì•¼ í•  ì¼ / ì—…ë¬´ ë©”ëª¨</label>
      <textarea id="s-tasks" placeholder="ì˜ˆ: 3í•™ë…„ ì‹œí—˜ì§€ ì±„ì , í•™ë¶€ëª¨ ìƒë‹´ ì—°ë½, í–‰ì •ì—…ë¬´ ì²˜ë¦¬, ìˆ˜ì—… ì¤€ë¹„, êµì§ì› íšŒì˜ ìë£Œ..." style="min-height:160px"></textarea>
    </div>

    <div class="form-group">
      <label>ì›í•˜ëŠ” ê²°ê³¼</label>
      <div class="chip-group" id="schedule-chips">
        <div class="chip selected" onclick="toggleChip(this)">ìš°ì„ ìˆœìœ„ ì •ë¦¬</div>
        <div class="chip" onclick="toggleChip(this)">ì‹œê°„ ë¸”ë¡ ë°°ë¶„</div>
        <div class="chip" onclick="toggleChip(this)">ë¹ ë¥¸ ì²˜ë¦¬ ë°©ë²• ì¡°ì–¸</div>
        <div class="chip" onclick="toggleChip(this)">ì´ë©”ì¼/ê³µë¬¸ ì´ˆì•ˆ</div>
      </div>
    </div>

    <button class="btn-primary" onclick="runSchedule()">
      <span>ğŸ—‚ï¸</span> ì •ë¦¬í•´ ì£¼ì„¸ìš”
    </button>

    <div class="result-box" id="schedule-result" style="display:none">
      <div class="result-header">
        <span class="result-title">ì—…ë¬´ ì •ë¦¬ ê²°ê³¼</span>
        <button class="copy-btn" onclick="copyResult('schedule-content')">ë³µì‚¬</button>
      </div>
      <div class="result-content" id="schedule-content"></div>
    </div>
  </div>

  <!-- ì£¼ì‹ ë¶„ì„ -->
  <div id="panel-stock" class="panel">
    <div class="panel-header">
      <div class="panel-title">ì£¼ì‹ <span class="accent">ë¶„ì„ ë³´ì¡°</span></div>
      <div class="panel-desc">ì¢…ëª©ì´ë‚˜ íˆ¬ì ìƒí™©ì„ ì„¤ëª…í•´ ì£¼ì„¸ìš”. AIê°€ ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ë¶„ì„í•´ ë“œë¦½ë‹ˆë‹¤.</div>
    </div>

    <div class="form-group">
      <label>ì¢…ëª©ëª… ë˜ëŠ” í‹°ì»¤</label>
      <input type="text" id="st-ticker" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì, 005930, AAPL, ì—”ë¹„ë””ì•„..." />
    </div>

    <div class="form-group">
      <label>ë¶„ì„ ìš”ì²­ ë‚´ìš©</label>
      <textarea id="st-query" placeholder="ì˜ˆ: ì´ ì¢…ëª©ì„ ì§€ê¸ˆ ì‚¬ë„ ë ê¹Œìš”? ìµœê·¼ ì‹¤ì ì´ ê¶ê¸ˆí•´ìš”. ì ì • ë§¤ìˆ˜ ì‹œì ì„ ì•Œê³  ì‹¶ì–´ìš”..." style="min-height:120px"></textarea>
    </div>

    <div class="form-group">
      <label>ë¶„ì„ ê´€ì </label>
      <div class="chip-group" id="stock-chips">
        <div class="chip selected" onclick="toggleChip(this)">ê¸°ë³¸ ë¶„ì„ (í€ë”ë©˜í„¸)</div>
        <div class="chip" onclick="toggleChip(this)">ê¸°ìˆ ì  ë¶„ì„ ê´€ì </div>
        <div class="chip" onclick="toggleChip(this)">ë¦¬ìŠ¤í¬ ìš”ì¸</div>
        <div class="chip" onclick="toggleChip(this)">íˆ¬ì ì „ëµ ì¡°ì–¸</div>
      </div>
    </div>

    <div class="warning-box">
      âš ï¸ AIì˜ ë¶„ì„ì€ ì°¸ê³ ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ íˆ¬ì ê²°ì •ì€ ë³¸ì¸ì˜ íŒë‹¨ê³¼ ì±…ì„ í•˜ì— ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤. ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„°ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </div>

    <button class="btn-primary" style="margin-top:20px" onclick="runStock()">
      <span>ğŸ”</span> ë¶„ì„ ì‹œì‘
    </button>

    <div class="result-box" id="stock-result" style="display:none">
      <div class="result-header">
        <span class="result-title">ì£¼ì‹ ë¶„ì„ ê²°ê³¼</span>
        <button class="copy-btn" onclick="copyResult('stock-content')">ë³µì‚¬</button>
      </div>
      <div class="result-content" id="stock-content"></div>
    </div>
  </div>

  <!-- í•™ìƒ ìƒë‹´ -->
  <div id="panel-counsel" class="panel">
    <div class="panel-header">
      <div class="panel-title">í•™ìƒ <span class="accent">ìƒë‹´ ê´€ë¦¬</span></div>
      <div class="panel-desc">í•™ìƒ ì •ë³´ì™€ ìƒë‹´ ê¸°ë¡ì„ ì €ì¥í•˜ê³ , AIë¡œ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤.</div>
    </div>

    <div class="counsel-layout">
      <!-- ì™¼ìª½: í•™ìƒ ëª©ë¡ -->
      <div class="student-sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title">í•™ìƒ ëª©ë¡</span>
          <button class="btn-add-student" onclick="openAddStudent()" title="í•™ìƒ ì¶”ê°€">+</button>
        </div>
        <div class="student-search">
          <input type="text" id="student-search-input" placeholder="ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()" />
        </div>
        <div class="student-list" id="student-list">
          <div class="empty-state">
            <div class="empty-icon">ğŸ‘¤</div>
            <p>+ ë²„íŠ¼ìœ¼ë¡œ<br>í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ìƒë‹´ ìƒì„¸ -->
      <div class="counsel-detail" id="counsel-detail">
        <div class="empty-state" style="margin: auto; padding: 80px 20px;">
          <div class="empty-icon">ğŸ«‚</div>
          <p>ì™¼ìª½ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ê±°ë‚˜<br>ìƒˆ í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- í•™ìƒ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-student" style="display:none" onclick="closeModalOverlay(event,'modal-student')">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modal-student-title">í•™ìƒ ì¶”ê°€</span>
      <button class="modal-close" onclick="closeModal('modal-student')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>ì´ë¦„ *</label>
          <input type="text" id="s-name" placeholder="í™ê¸¸ë™" />
        </div>
        <div class="form-group">
          <label>í•™ë²ˆ/ë²ˆí˜¸</label>
          <input type="text" id="s-number" placeholder="ì˜ˆ: 3-2 / 15ë²ˆ" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>í•™ë…„/ë°˜</label>
          <input type="text" id="s-class" placeholder="ì˜ˆ: 3í•™ë…„ 2ë°˜" />
        </div>
        <div class="form-group">
          <label>ë³´í˜¸ì ì—°ë½ì²˜</label>
          <input type="text" id="s-parent-tel" placeholder="010-0000-0000" />
        </div>
      </div>
      <div class="form-group">
        <label>í•™ìƒ íŠ¹ì„± / ê¸°ë³¸ ë©”ëª¨</label>
        <textarea id="s-memo" placeholder="í•™ìŠµ íŠ¹ì„±, ì„±ê²©, ì£¼ì˜ì‚¬í•­ ë“± ê¸°ë³¸ ì •ë³´ë¥¼ ì ì–´ë‘ì„¸ìš”..." style="min-height:90px"></textarea>
      </div>
      <div class="form-group">
        <label>ì£¼ìš” ê´€ì‹¬ì‚¬/ê°•ì </label>
        <input type="text" id="s-strength" placeholder="ì˜ˆ: ìˆ˜í•™ ìš°ìˆ˜, ë¯¸ìˆ  ì¢‹ì•„í•¨, ë¦¬ë”ì‹­ ìˆìŒ..." />
      </div>
      <div class="form-group">
        <label>ì£¼ì˜ ê´€ì°° ì‚¬í•­</label>
        <input type="text" id="s-concern" placeholder="ì˜ˆ: ì£¼ì˜ë ¥ ë¶€ì¡±, êµìš°ê´€ê³„ ì–´ë ¤ì›€, ê°€ì •í™˜ê²½ íŠ¹ì´ì‚¬í•­..." />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('modal-student')">ì·¨ì†Œ</button>
      <button class="btn-primary" onclick="saveStudent()">ğŸ’¾ ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ìƒë‹´ ê¸°ë¡ ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-record" style="display:none" onclick="closeModalOverlay(event,'modal-record')">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">ìƒë‹´ ê¸°ë¡ ì¶”ê°€</span>
      <button class="modal-close" onclick="closeModal('modal-record')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>ìƒë‹´ ë‚ ì§œ</label>
          <input type="date" id="r-date" />
        </div>
        <div class="form-group">
          <label>ìƒë‹´ ìœ í˜•</label>
          <select id="r-type">
            <option value="student">í•™ìƒ ìƒë‹´</option>
            <option value="parent">í•™ë¶€ëª¨ ìƒë‹´</option>
            <option value="phone">ì „í™” ìƒë‹´</option>
            <option value="etc">ê¸°íƒ€</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ìƒë‹´ ì£¼ì œ</label>
        <input type="text" id="r-topic" placeholder="ì˜ˆ: í•™ìŠµ ë¶€ì§„, êµìš°ê´€ê³„, ì§„ë¡œ ê³ ë¯¼, ê°€ì •í™˜ê²½..." />
      </div>
      <div class="form-group">
        <label>ìƒë‹´ ë‚´ìš©</label>
        <textarea id="r-content" placeholder="ìƒë‹´ì—ì„œ ë‚˜ì˜¨ ì£¼ìš” ë‚´ìš©, í•™ìƒ/í•™ë¶€ëª¨ ë°˜ì‘, íŠ¹ì´ì‚¬í•­ ë“±..." style="min-height:130px"></textarea>
      </div>
      <div class="form-group">
        <label>í›„ì† ì¡°ì¹˜ / ë‹¤ìŒ ê³„íš</label>
        <textarea id="r-followup" placeholder="ë‹¤ìŒ ìƒë‹´ ì¼ì •, ë‹´ì„ ì¡°ì¹˜ ì‚¬í•­, ì—°ê³„ ê¸°ê´€ ë“±..." style="min-height:70px"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('modal-record')">ì·¨ì†Œ</button>
      <button class="btn-primary" onclick="saveRecord()">ğŸ’¾ ê¸°ë¡ ì €ì¥</button>
    </div>
  </div>
</div>

<script>
let apiKey = '';

function saveKey() {
  apiKey = document.getElementById('apiKey').value.trim();
  if (apiKey) {
    localStorage.setItem('teacher-gemini-key', apiKey);
    alert('âœ… Gemini API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒë¶€í„° ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.');
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í‚¤ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
const _savedKey = localStorage.getItem('teacher-gemini-key');
if (_savedKey) {
  apiKey = _savedKey;
  document.getElementById('apiKey').value = _savedKey;
}

function deleteKey() {
  if (!confirm('ì €ì¥ëœ API í‚¤ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
  localStorage.removeItem('teacher-gemini-key');
  apiKey = '';
  document.getElementById('apiKey').value = '';
  alert('ğŸ—‘ï¸ API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function showTab(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  event.target.classList.add('active');
}

function toggleChip(el) {
  el.classList.toggle('selected');
}

function selectOne(el, groupId) {
  document.querySelectorAll('#' + groupId + ' .chip').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}

function getSelectedChips(groupId) {
  return Array.from(document.querySelectorAll('#' + groupId + ' .chip.selected')).map(c => c.textContent.trim());
}

async function callClaude(systemPrompt, userPrompt, resultEl, boxEl, isPoem = false) {
  if (!apiKey) {
    alert('Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return;
  }

  boxEl.style.display = 'block';
  resultEl.innerHTML = `<div style="padding:30px;text-align:center"><div class="loading-dots"><span></span><span></span><span></span></div><br><small style="color:rgba(26,20,16,0.4)">AIê°€ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</small></div>`;

  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: systemPrompt + '\n\n' + userPrompt }] }],
        generationConfig: { maxOutputTokens: 2000 }
      })
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.error?.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }

    const data = await response.json();
    const text = data.candidates[0].content.parts[0].text;
    resultEl.textContent = text;
    if (isPoem) {
      resultEl.style.whiteSpace = 'pre-wrap';
    }
  } catch (e) {
    resultEl.textContent = 'âŒ ì˜¤ë¥˜: ' + e.message + '\n\nAPI í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
  }
}

function runLesson() {
  const subject = document.getElementById('l-subject').value;
  const grade = document.getElementById('l-grade').value;
  const topic = document.getElementById('l-topic').value;
  const materials = getSelectedChips('material-chips');

  if (!topic) { alert('ë‹¨ì›/ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const system = `ë‹¹ì‹ ì€ í•œêµ­ì˜ ìˆ™ë ¨ëœ êµì‚¬ë¥¼ ë•ëŠ” êµìœ¡ ì „ë¬¸ AIì…ë‹ˆë‹¤. 
ì‹¤ì œ ìˆ˜ì—…ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ìš©ì ì´ê³  ì™„ì„±ë„ ë†’ì€ êµìœ¡ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.
í•œêµ­ êµìœ¡ê³¼ì • ë§¥ë½ì— ë§ê²Œ ì‘ì„±í•˜ê³ , ë§ˆí¬ë‹¤ìš´ë³´ë‹¤ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`;

  const user = `ë‹¤ìŒ ì •ë³´ë¡œ ìˆ˜ì—… ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”:
- ê³¼ëª©: ${subject || 'ë¯¸ì§€ì •'}
- í•™ë…„: ${grade || 'ë¯¸ì§€ì •'}  
- ë‹¨ì›/ì£¼ì œ: ${topic}
- ìƒì„±í•  ìë£Œ: ${materials.join(', ')}

ê° ìë£Œ ì¢…ë¥˜ë¥¼ êµ¬ë¶„í•´ì„œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`;

  callClaude(system, user,
    document.getElementById('lesson-content'),
    document.getElementById('lesson-result'));
}

function runGrade() {
  const rubric = document.getElementById('g-rubric').value;
  const student = document.getElementById('g-student').value;
  const tone = getSelectedChips('tone-chips')[0] || 'ë”°ëœ»í•˜ê³  ê²©ë ¤ì ';

  if (!student) { alert('í•™ìƒ ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const system = `ë‹¹ì‹ ì€ í•œêµ­ êµì‚¬ë¥¼ ë•ëŠ” êµìœ¡ í‰ê°€ ì „ë¬¸ AIì…ë‹ˆë‹¤.
í•™ìƒì˜ ì„±ì¥ì„ ë•ëŠ” ê±´ì„¤ì ì´ê³  êµ¬ì²´ì ì¸ í”¼ë“œë°±ì„ ì‘ì„±í•©ë‹ˆë‹¤.
í”¼ë“œë°± í†¤: ${tone}
í˜•ì‹: ì˜í•œ ì  â†’ ê°œì„ í•  ì  â†’ ì¢…í•© í‰ê°€ ìˆœìœ¼ë¡œ ì‘ì„±`;

  const user = `ë‹¤ìŒ í•™ìƒì˜ ë‹µì•ˆì— í”¼ë“œë°±ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.
${rubric ? `í‰ê°€ ê¸°ì¤€: ${rubric}\n` : ''}
í•™ìƒ ë‹µì•ˆ:
${student}`;

  callClaude(system, user,
    document.getElementById('grade-content'),
    document.getElementById('grade-result'));
}

function runPoem() {
  const mood = document.getElementById('p-mood').value;
  const subject = document.getElementById('p-subject').value;
  const form = getSelectedChips('poem-chips')[0] || 'ììœ ì‹œ';
  const note = document.getElementById('p-note').value;

  if (!mood && !subject) { alert('ê°ì •ì´ë‚˜ ì†Œì¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const system = `ë‹¹ì‹ ì€ í•œêµ­ í˜„ëŒ€ì‹œë¥¼ ì „ë¬¸ìœ¼ë¡œ í•˜ëŠ” ì‹œì¸ ê²¸ ë¬¸í•™ êµì‚¬ì…ë‹ˆë‹¤.
ì‹œë¥¼ ì“°ê³  ì‹¶ì€ 50ëŒ€ êµì‚¬ë¥¼ ìœ„í•´ ì§„ì •ì„± ìˆëŠ” ì‹œ ì´ˆê³ ë¥¼ ì¨ ì£¼ì„¸ìš”.
ì¼ìƒì˜ ì†Œì†Œí•¨ì—ì„œ ê¹Šì´ë¥¼ ì°¾ëŠ” ì„œì •ì ì´ê³  ë”°ëœ»í•œ ì‹œí’ì„ ì¶”êµ¬í•˜ì„¸ìš”.
ê³¼ë„í•œ ìˆ˜ì‚¬ë‚˜ ì§„ë¶€í•œ í‘œí˜„ì€ í”¼í•˜ê³ , ë…ìì ì¸ ì´ë¯¸ì§€ì™€ ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.`;

  const user = `ë‹¤ìŒ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ${form} í˜•ì‹ì˜ ì‹œ ì´ˆê³ ë¥¼ ì¨ ì£¼ì„¸ìš”.
ê°ì •/ìƒíƒœ: ${mood || ''}
ì†Œì¬/ì´ë¯¸ì§€: ${subject || ''}
${note ? `ì¶”ê°€ ë©”ëª¨: ${note}` : ''}

ì‹œë§Œ ì¶œë ¥í•´ ì£¼ì„¸ìš”. ì œëª©ë„ ë¶™ì—¬ ì£¼ì„¸ìš”.`;

  callClaude(system, user,
    document.getElementById('poem-content'),
    document.getElementById('poem-result'), true);
}

function runSchedule() {
  const tasks = document.getElementById('s-tasks').value;
  const wants = getSelectedChips('schedule-chips');

  if (!tasks) { alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const system = `ë‹¹ì‹ ì€ ë°”ìœ êµì‚¬ë¥¼ ìœ„í•œ ì—…ë¬´ ê´€ë¦¬ ì „ë¬¸ AIì…ë‹ˆë‹¤.
êµì‚¬ì˜ í˜„ì‹¤ì ì¸ ì—…ë¬´ í™˜ê²½ì„ ì´í•´í•˜ê³ , ì‹¤ì§ˆì ìœ¼ë¡œ ë„ì›€ì´ ë˜ëŠ” ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤.
ê³¼ë„í•œ ì„¤ëª… ì—†ì´ í•µì‹¬ì„ ëª…í™•í•˜ê²Œ ì •ë¦¬í•´ ì£¼ì„¸ìš”.`;

  const user = `ë‹¤ìŒ ì—…ë¬´ë¥¼ ì •ë¦¬í•´ ì£¼ì„¸ìš”:
${tasks}

ìš”ì²­ ì‚¬í•­: ${wants.join(', ')}`;

  callClaude(system, user,
    document.getElementById('schedule-content'),
    document.getElementById('schedule-result'));
}

function runStock() {
  const ticker = document.getElementById('st-ticker').value;
  const query = document.getElementById('st-query').value;
  const aspects = getSelectedChips('stock-chips');

  if (!query) { alert('ë¶„ì„ ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const system = `ë‹¹ì‹ ì€ íˆ¬ì ë¶„ì„ì„ ë„ì™€ì£¼ëŠ” AIì…ë‹ˆë‹¤.
ì¤‘ìš”: ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„°ëŠ” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ì¸ ë¶„ì„ í”„ë ˆì„ì›Œí¬ì™€ íŒë‹¨ ê¸°ì¤€ì„ ì œê³µí•©ë‹ˆë‹¤.
íˆ¬ì ê²°ì •ì€ ì‚¬ìš©ì ë³¸ì¸ì´ í•´ì•¼ í•¨ì„ í•­ìƒ ëª…ì‹œí•˜ì„¸ìš”.
ê· í˜• ì¡íŒ ì‹œê°ìœ¼ë¡œ ì¥ë‹¨ì ì„ í•¨ê»˜ ì œì‹œí•´ ì£¼ì„¸ìš”.`;

  const user = `ì¢…ëª©: ${ticker || 'ë¯¸ì§€ì •'}
ì§ˆë¬¸: ${query}
ë¶„ì„ ê´€ì : ${aspects.join(', ')}

ìœ„ ë‚´ìš©ì„ ë¶„ì„í•´ ì£¼ì„¸ìš”. íˆ¬ì ê²°ì •ì€ ë³¸ì¸ ì±…ì„ì„ì„ ìƒê¸°ì‹œì¼œ ì£¼ì„¸ìš”.`;

  callClaude(system, user,
    document.getElementById('stock-content'),
    document.getElementById('stock-result'));
}

function copyResult(id) {
  const text = document.getElementById(id).textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = event.target;
    btn.textContent = 'ë³µì‚¬ë¨ âœ“';
    setTimeout(() => btn.textContent = 'ë³µì‚¬', 2000);
  });
}

/* =============================================
   í•™ìƒ ìƒë‹´ ê´€ë¦¬ ì‹œìŠ¤í…œ
   ë°ì´í„° êµ¬ì¡°:
   - students: { id: { name, number, class, parentTel, memo, strength, concern, createdAt } }
   - records:  { studentId: [ { id, date, type, topic, content, followup } ] }
   ============================================= */

let students = {};
let counselRecords = {};
let currentStudentId = null;
let editingStudentId = null;

const STUDENTS_KEY = 'teacher-students';
const RECORDS_KEY = 'teacher-records';

// ì´ˆê¸° ë¡œë“œ
async function loadCounselData() {
  try {
    const sResult = await window.storage.get(STUDENTS_KEY);
    if (sResult) students = JSON.parse(sResult.value);
  } catch(e) { students = {}; }
  try {
    const rResult = await window.storage.get(RECORDS_KEY);
    if (rResult) counselRecords = JSON.parse(rResult.value);
  } catch(e) { counselRecords = {}; }
  renderStudentList();
}

async function saveStudentsToStorage() {
  try { await window.storage.set(STUDENTS_KEY, JSON.stringify(students)); } catch(e) {}
}

async function saveRecordsToStorage() {
  try { await window.storage.set(RECORDS_KEY, JSON.stringify(counselRecords)); } catch(e) {}
}

function genId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 6);
}

/* -- í•™ìƒ ëª©ë¡ ë Œë”ë§ -- */
function renderStudentList(filter = '') {
  const list = document.getElementById('student-list');
  const ids = Object.keys(students).filter(id => {
    const s = students[id];
    return !filter || s.name.includes(filter) || (s.sClass || '').includes(filter);
  });

  if (ids.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ‘¤</div><p>+ ë²„íŠ¼ìœ¼ë¡œ<br>í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p></div>`;
    return;
  }

  list.innerHTML = ids.map(id => {
    const s = students[id];
    const recordCount = (counselRecords[id] || []).length;
    const isActive = id === currentStudentId;
    return `<div class="student-card ${isActive ? 'active' : ''}" onclick="selectStudent('${id}')">
      <div class="student-card-name">${s.name}${recordCount > 0 ? `<span class="student-card-badge">${recordCount}ê±´</span>` : ''}</div>
      <div class="student-card-meta">${s.sClass || ''}${s.number ? ' Â· ' + s.number : ''}</div>
    </div>`;
  }).join('');
}

function filterStudents() {
  const q = document.getElementById('student-search-input').value.trim();
  renderStudentList(q);
}

/* -- í•™ìƒ ì„ íƒ -- */
function selectStudent(id) {
  currentStudentId = id;
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

/* -- ìƒë‹´ ìƒì„¸ ì˜ì—­ ë Œë”ë§ -- */
function renderCounselDetail() {
  const detail = document.getElementById('counsel-detail');
  if (!currentStudentId || !students[currentStudentId]) {
    detail.innerHTML = `<div class="empty-state" style="margin:auto;padding:80px 20px"><div class="empty-icon">ğŸ«‚</div><p>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</p></div>`;
    return;
  }
  const s = students[currentStudentId];
  const records = counselRecords[currentStudentId] || [];

  detail.innerHTML = `
    <!-- í•™ìƒ ê¸°ë³¸ ì •ë³´ ì¹´ë“œ -->
    <div class="detail-card">
      <div class="detail-card-header">
        <span class="detail-card-title">ğŸ‘¤ ${s.name} í•™ìƒ ì •ë³´</span>
        <div style="display:flex;gap:8px">
          <button class="btn-secondary" style="padding:6px 14px;font-size:0.78rem" onclick="openEditStudent('${currentStudentId}')">âœï¸ í¸ì§‘</button>
          <button class="btn-secondary" style="padding:6px 14px;font-size:0.78rem;color:var(--red)" onclick="deleteStudent('${currentStudentId}')">ì‚­ì œ</button>
        </div>
      </div>
      <div class="detail-card-body">
        <div class="form-row" style="gap:12px;margin-bottom:0">
          <div><small style="color:rgba(26,20,16,0.5);font-size:0.75rem;text-transform:uppercase;letter-spacing:0.03em">í•™ë…„/ë°˜</small><div style="font-size:0.9rem;margin-top:4px">${s.sClass || '-'}</div></div>
          <div><small style="color:rgba(26,20,16,0.5);font-size:0.75rem;text-transform:uppercase;letter-spacing:0.03em">ë²ˆí˜¸</small><div style="font-size:0.9rem;margin-top:4px">${s.number || '-'}</div></div>
          <div><small style="color:rgba(26,20,16,0.5);font-size:0.75rem;text-transform:uppercase;letter-spacing:0.03em">ë³´í˜¸ì ì—°ë½ì²˜</small><div style="font-size:0.9rem;margin-top:4px">${s.parentTel || '-'}</div></div>
        </div>
        ${s.strength ? `<div style="margin-top:14px"><small style="color:var(--sage);font-size:0.75rem;font-weight:600">âœ… ê°•ì /ê´€ì‹¬ì‚¬</small><div style="font-size:0.88rem;margin-top:4px;line-height:1.6">${s.strength}</div></div>` : ''}
        ${s.concern ? `<div style="margin-top:10px"><small style="color:#c0392b;font-size:0.75rem;font-weight:600">âš ï¸ ì£¼ì˜ ê´€ì°° ì‚¬í•­</small><div style="font-size:0.88rem;margin-top:4px;line-height:1.6">${s.concern}</div></div>` : ''}
        ${s.memo ? `<div style="margin-top:10px"><small style="color:rgba(26,20,16,0.5);font-size:0.75rem">ğŸ“ ë©”ëª¨</small><div style="font-size:0.88rem;margin-top:4px;line-height:1.7;white-space:pre-wrap">${s.memo}</div></div>` : ''}
      </div>
    </div>

    <!-- ìƒë‹´ ê¸°ë¡ -->
    <div class="detail-card">
      <div class="detail-card-header">
        <span class="detail-card-title">ğŸ“‹ ìƒë‹´ ê¸°ë¡ (${records.length}ê±´)</span>
        <button class="btn-secondary" style="padding:6px 14px;font-size:0.78rem" onclick="openAddRecord()">+ ê¸°ë¡ ì¶”ê°€</button>
      </div>
      <div class="detail-card-body">
        ${records.length === 0
          ? `<div class="empty-state" style="padding:30px"><div class="empty-icon" style="font-size:1.8rem">ğŸ“</div><p>ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p></div>`
          : `<div class="record-list">${records.slice().reverse().map(r => `
            <div class="record-item">
              <button class="record-delete" onclick="deleteRecord('${currentStudentId}','${r.id}')">Ã—</button>
              <div class="record-item-date">
                ${r.date || 'ë‚ ì§œ ë¯¸ì§€ì •'}
                <span class="record-type-badge ${r.type === 'parent' ? 'badge-parent' : 'badge-student'}">${getTypeLabel(r.type)}</span>
                ${r.topic ? `<span style="color:rgba(26,20,16,0.6);font-size:0.75rem">Â· ${r.topic}</span>` : ''}
              </div>
              <div class="record-item-content">${r.content || ''}</div>
              ${r.followup ? `<div style="margin-top:8px;padding:8px 10px;background:rgba(107,124,94,0.08);border-radius:6px;font-size:0.82rem;color:var(--sage);line-height:1.6">â†’ ${r.followup}</div>` : ''}
            </div>`).join('')}
          </div>`
        }
      </div>
    </div>

    <!-- AI í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„± -->
    <div class="detail-card">
      <div class="detail-card-header">
        <span class="detail-card-title">ğŸ¤– AI í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„±</span>
      </div>
      <div class="detail-card-body">
        <div class="form-group">
          <label>ì´ë²ˆ ìƒë‹´ ëª©ì  / ì£¼ìš” ì•ˆê±´</label>
          <textarea id="parent-agenda" placeholder="ì˜ˆ: í•™ìŠµ ë¶€ì§„ ì›ì¸ íŒŒì•…, ìƒí™œ íƒœë„ ê°œì„ , ì§„ë¡œ ë°©í–¥ ë…¼ì˜, ê¸ì •ì  ë³€í™” ê³µìœ ..." style="min-height:80px"></textarea>
        </div>
        <div class="form-group">
          <label>ìƒë‹´ ë°©ì‹</label>
          <div class="chip-group" id="parent-mode-chips">
            <div class="chip selected" onclick="selectOne(this,'parent-mode-chips')">ëŒ€ë©´ ìƒë‹´</div>
            <div class="chip" onclick="selectOne(this,'parent-mode-chips')">ì „í™” ìƒë‹´</div>
            <div class="chip" onclick="selectOne(this,'parent-mode-chips')">ê°€ì •í†µì‹ ë¬¸</div>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label>í¬í•¨í•  ë‚´ìš©</label>
          <div class="chip-group" id="parent-include-chips">
            <div class="chip selected" onclick="toggleChip(this)">í•™ìƒ í˜„í™© ìš”ì•½</div>
            <div class="chip selected" onclick="toggleChip(this)">ìƒë‹´ ê¸°ë¡ ë°˜ì˜</div>
            <div class="chip" onclick="toggleChip(this)">ê°€ì • í˜‘ì¡° ìš”ì²­ì‚¬í•­</div>
            <div class="chip" onclick="toggleChip(this)">ì•ìœ¼ë¡œì˜ ì§€ì› ê³„íš</div>
            <div class="chip" onclick="toggleChip(this)">ê¸ì •ì  ë³€í™” ê°•ì¡°</div>
          </div>
        </div>
        <button class="btn-primary" style="margin-top:20px" onclick="runParentCounsel()">
          <span>âœ¨</span> í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„±
        </button>
        <div id="parent-result-box" style="display:none;margin-top:20px">
          <div class="result-box" style="margin-top:0">
            <div class="result-header">
              <span class="result-title">ìƒì„±ëœ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ</span>
              <button class="copy-btn" onclick="copyResult('parent-result-content')">ë³µì‚¬</button>
            </div>
            <div class="result-content" id="parent-result-content"></div>
          </div>
        </div>
      </div>
    </div>
  `;
}

function getTypeLabel(type) {
  const map = { student: 'í•™ìƒ ìƒë‹´', parent: 'í•™ë¶€ëª¨ ìƒë‹´', phone: 'ì „í™” ìƒë‹´', etc: 'ê¸°íƒ€' };
  return map[type] || type;
}

/* -- ëª¨ë‹¬ -- */
function openAddStudent() {
  editingStudentId = null;
  document.getElementById('modal-student-title').textContent = 'í•™ìƒ ì¶”ê°€';
  ['s-name','s-number','s-class','s-parent-tel','s-memo','s-strength','s-concern'].forEach(id => {
    document.getElementById(id).value = '';
  });
  document.getElementById('modal-student').style.display = 'flex';
}

function openEditStudent(id) {
  editingStudentId = id;
  const s = students[id];
  document.getElementById('modal-student-title').textContent = 'í•™ìƒ ì •ë³´ í¸ì§‘';
  document.getElementById('s-name').value = s.name || '';
  document.getElementById('s-number').value = s.number || '';
  document.getElementById('s-class').value = s.sClass || '';
  document.getElementById('s-parent-tel').value = s.parentTel || '';
  document.getElementById('s-memo').value = s.memo || '';
  document.getElementById('s-strength').value = s.strength || '';
  document.getElementById('s-concern').value = s.concern || '';
  document.getElementById('modal-student').style.display = 'flex';
}

function openAddRecord() {
  document.getElementById('r-date').value = new Date().toISOString().slice(0, 10);
  document.getElementById('r-type').value = 'student';
  document.getElementById('r-topic').value = '';
  document.getElementById('r-content').value = '';
  document.getElementById('r-followup').value = '';
  document.getElementById('modal-record').style.display = 'flex';
}

function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}

function closeModalOverlay(e, id) {
  if (e.target === e.currentTarget) closeModal(id);
}

async function saveStudent() {
  const name = document.getElementById('s-name').value.trim();
  if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const data = {
    name,
    number: document.getElementById('s-number').value.trim(),
    sClass: document.getElementById('s-class').value.trim(),
    parentTel: document.getElementById('s-parent-tel').value.trim(),
    memo: document.getElementById('s-memo').value.trim(),
    strength: document.getElementById('s-strength').value.trim(),
    concern: document.getElementById('s-concern').value.trim(),
    createdAt: editingStudentId ? (students[editingStudentId]?.createdAt || Date.now()) : Date.now()
  };

  const id = editingStudentId || genId();
  students[id] = data;
  await saveStudentsToStorage();
  closeModal('modal-student');
  currentStudentId = id;
  renderStudentList();
  renderCounselDetail();
}

async function deleteStudent(id) {
  if (!confirm(`${students[id]?.name} í•™ìƒì˜ ëª¨ë“  ì •ë³´ì™€ ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
  delete students[id];
  delete counselRecords[id];
  if (currentStudentId === id) currentStudentId = null;
  await saveStudentsToStorage();
  await saveRecordsToStorage();
  renderStudentList();
  renderCounselDetail();
}

async function saveRecord() {
  if (!currentStudentId) return;
  const content = document.getElementById('r-content').value.trim();
  if (!content) { alert('ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

  const record = {
    id: genId(),
    date: document.getElementById('r-date').value,
    type: document.getElementById('r-type').value,
    topic: document.getElementById('r-topic').value.trim(),
    content,
    followup: document.getElementById('r-followup').value.trim()
  };

  if (!counselRecords[currentStudentId]) counselRecords[currentStudentId] = [];
  counselRecords[currentStudentId].push(record);
  await saveRecordsToStorage();
  closeModal('modal-record');
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

async function deleteRecord(studentId, recordId) {
  if (!confirm('ì´ ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) return;
  counselRecords[studentId] = (counselRecords[studentId] || []).filter(r => r.id !== recordId);
  await saveRecordsToStorage();
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

/* -- AI í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„± -- */
async function runParentCounsel() {
  if (!currentStudentId) return;
  const s = students[currentStudentId];
  const records = (counselRecords[currentStudentId] || []);
  const agenda = document.getElementById('parent-agenda').value.trim();
  const mode = getSelectedChips('parent-mode-chips')[0] || 'ëŒ€ë©´ ìƒë‹´';
  const includes = getSelectedChips('parent-include-chips');

  if (!apiKey) { alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

  const resultBox = document.getElementById('parent-result-box');
  const resultEl = document.getElementById('parent-result-content');
  resultBox.style.display = 'block';
  resultEl.innerHTML = `<div style="padding:30px;text-align:center"><div class="loading-dots"><span></span><span></span><span></span></div><br><small>AIê°€ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...</small></div>`;

  const recordSummary = records.length > 0
    ? records.slice(-5).map(r => `[${r.date} Â· ${getTypeLabel(r.type)}] ${r.topic ? r.topic + ' â€” ' : ''}${r.content}${r.followup ? '\nâ†’ ì¡°ì¹˜: ' + r.followup : ''}`).join('\n\n')
    : 'ì´ì „ ìƒë‹´ ê¸°ë¡ ì—†ìŒ';

  const system = `ë‹¹ì‹ ì€ í•œêµ­ì˜ ê²½í—˜ ë§ì€ ë‹´ì„êµì‚¬ì…ë‹ˆë‹¤. í•™ë¶€ëª¨ì™€ì˜ ìƒë‹´ì„ ìœ„í•œ ìë£Œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
ë”°ëœ»í•˜ê³  ì „ë¬¸ì ì¸ ì–´ì¡°ë¡œ, í•™ìƒì˜ ì„±ì¥ê³¼ ë°œì „ì— ì´ˆì ì„ ë§ì¶° ì‘ì„±í•˜ì„¸ìš”.
ìƒë‹´ ë°©ì‹: ${mode}
í¬í•¨ ë‚´ìš©: ${includes.join(', ')}`;

  const user = `ë‹¤ìŒ í•™ìƒì˜ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.

[í•™ìƒ ê¸°ë³¸ ì •ë³´]
ì´ë¦„: ${s.name}
í•™ë…„/ë°˜: ${s.sClass || 'ë¯¸ì§€ì •'}
ê°•ì /ê´€ì‹¬ì‚¬: ${s.strength || 'ì—†ìŒ'}
ì£¼ì˜ ê´€ì°° ì‚¬í•­: ${s.concern || 'ì—†ìŒ'}
íŠ¹ì´ì‚¬í•­: ${s.memo || 'ì—†ìŒ'}

[ìµœê·¼ ìƒë‹´ ê¸°ë¡]
${recordSummary}

[ì´ë²ˆ ìƒë‹´ ì•ˆê±´]
${agenda || 'ì „ë°˜ì ì¸ í•™ìƒ í˜„í™© ê³µìœ '}

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ ìƒë‹´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì™„ì„±ë„ ë†’ì€ ìë£Œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.`;

  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: system + '\n\n' + user }] }],
        generationConfig: { maxOutputTokens: 2000 }
      })
    });
    const data = await response.json();
    resultEl.textContent = data.candidates[0].content.parts[0].text;
  } catch(e) {
    resultEl.textContent = 'âŒ ì˜¤ë¥˜: ' + e.message;
  }
}

// ìƒë‹´ íƒ­ ì§„ì… ì‹œ ë°ì´í„° ë¡œë“œ
document.querySelector('[onclick="showTab(\'counsel\')"]').addEventListener('click', () => {
  if (Object.keys(students).length === 0) loadCounselData();
});

// ì´ˆê¸° ì‹¤í–‰
loadCounselData();
</script>
</body>
</html>
